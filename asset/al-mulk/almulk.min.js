<script>
(function () {
  'use strict';

  // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openPrintWindow(title, innerHtml) {
    var w = window.open('', '_blank');
    if (!w) {
      alert('Pelayar blok pop-up. Sila benarkan pop-up untuk cetak.');
      return;
    }

    var html =
      '<!doctype html>' +
      '<html lang="ms">' +
      '<head>' +
      '<meta charset="utf-8">' +
      '<title>' + title + '</title>' +
      '<style>' +
      'body{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;margin:20px;color:#111;}' +
      'h1{font-size:20px;margin-bottom:8px;}' +
      '.meta{margin-bottom:14px;font-size:13px;}' +
      'table{width:100%;border-collapse:collapse;font-size:13px;}' +
      'th,td{border:1px solid #ddd;padding:6px 8px;text-align:center;}' +
      'th{background:#249749;color:#fff;}' +
      '.footer{margin-top:16px;font-size:11px;color:#555;}' +
      '@media print{body{margin:8mm;}}' +
      '</style>' +
      '</head>' +
      '<body>' +
      innerHtml +
      '<script>window.onload=function(){window.focus();window.print();};<\/script>' +
      '</body></html>';

    w.document.open();
    w.document.write(html);
    w.document.close();
  }

  function getZoneText() {
    var el = document.querySelector('.ws-tool__location');
    if (!el) return '';
    return el.textContent.replace(/^ðŸ“Œ\s*/, '').trim();
  }

  function getHijriAndDate() {
    var h = document.querySelector('.ws-tool__date-hijri');
    var g = document.querySelector('.ws-tool__date-gregorian');
    return {
      hijri: h ? h.textContent.trim() : '',
      greg: g ? g.textContent.trim() : ''
    };
  }

  // â”€â”€ PDF: Hari ini â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function printToday() {
    var cards = document.querySelectorAll('#ws-main-content .ws-tool__time-card');
    if (!cards.length) {
      alert('Data waktu solat belum muncul. Pastikan tab "Waktu Solat Hari Ini" dibuka dan tunggu sekejap.');
      return;
    }

    var zone = getZoneText() || 'Zon';
    var d = getHijriAndDate();
    var rowsHtml = '';

    cards.forEach(function (card) {
      var label = card.querySelector('.ws-tool__time-label');
      var val   = card.querySelector('.ws-tool__time-value');
      if (!label || !val) return;
      rowsHtml += '<tr><td>' + label.textContent.trim() +
                  '</td><td>' + val.textContent.trim() + '</td></tr>';
    });

    var title = 'Jadual Waktu Solat Hari Ini - ' + zone;

    var inner =
      '<h1>' + title + '</h1>' +
      '<div class="meta">' +
        (d.greg ? '<div><strong>Tarikh (Masihi):</strong> ' + d.greg + '</div>' : '') +
        (d.hijri ? '<div><strong>Tarikh (Hijri):</strong> ' + d.hijri + '</div>' : '') +
        '<div><strong>Zon:</strong> ' + zone + '</div>' +
      '</div>' +
      '<table>' +
        '<thead><tr><th>Waktu</th><th>Jam</th></tr></thead>' +
        '<tbody>' + rowsHtml + '</tbody>' +
      '</table>' +
      '<div class="footer">' +
        'Data rasmi JAKIM / fallback Aladhan Â· Dijana dari IlmuAlam.com' +
      '</div>';

    openPrintWindow(title, inner);
  }

  // â”€â”€ PDF: Bulanan â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function printMonthly() {
    var table = document.querySelector('#ws-monthly-content table.ws-tool__table');
    if (!table) {
      alert('Sila buka tab "Jadual Bulanan" dulu supaya data dimuat.');
      return;
    }

    var zone = getZoneText() || 'Zon';
    var title = 'Jadual Waktu Solat Bulanan - ' + zone;

    var theadHtml = table.tHead ? table.tHead.innerHTML : '';
    var tbodyHtml = table.tBodies[0] ? table.tBodies[0].innerHTML : '';

    var inner =
      '<h1>' + title + '</h1>' +
      '<div class="meta"><div><strong>Zon:</strong> ' + zone + '</div></div>' +
      '<table>' +
        '<thead>' + theadHtml + '</thead>' +
        '<tbody>' + tbodyHtml + '</tbody>' +
      '</table>' +
      '<div class="footer">' +
        'Data rasmi JAKIM / fallback Aladhan Â· Dijana dari IlmuAlam.com' +
      '</div>';

    openPrintWindow(title, inner);
  }

  // â”€â”€ Hook butang â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  window.addEventListener('DOMContentLoaded', function () {
    var btnToday =
      document.getElementById('ws-pdf-today-btn') ||
      document.getElementById('ws-pdf-btn');

    var btnMonthly = document.getElementById('ws-pdf-monthly-btn');

    if (btnToday) {
      btnToday.addEventListener('click', function (e) {
        e.preventDefault();
        printToday();
      });
    }

    if (btnMonthly) {
      btnMonthly.addEventListener('click', function (e) {
        e.preventDefault();
        printMonthly();
      });
    }
  });
})();
</script>
